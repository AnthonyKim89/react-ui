# Dev Notes 2016-11-01

I strongly recommend an architectural direction for the new frontend where we have a clear separation between the Rails server app and the React browser app. Instead of having tightly integrated “React stuff” in Rails views, we should consider the frontend React app an independent entity that runs on its own, handles its own routing, etc. The Rails app provides JSON APIs for the frontend app, but doesn’t concern itself with view logic.

This allows the two apps to be evolved separately. It minimizes Rails view code which was always that framework’s weakest point. It allows breaking the backend APIs to microservices at some point if necessary. It allows the frontend code to use modern JavaScript tooling without restrictions.

With this in mind, I created a new frontend project using [create-react-app](https://facebook.github.io/react/blog/2016/07/22/create-apps-with-no-configuration.html), to ensure we’re getting off on the right foot with Facebook’s best practices on how React apps should be constructed.

The project contains:

* A full React app development environment based on create-react-app. Includes support for testing, packaging, listing, etc.
* Bootstrap 3 and react-bootstrap.
* Some CSS, fonts, and images brought over from corva-web.
* A routing and navigation scheme based on react-router and HTML5 pushState.
* A very preliminary “widget” implementation.

## Integration with corva-web

In practice, this application will probably coexist with existing Rails views for quite some time. Although the long-term goal would be to replace the view layer of the Rails app completely, I don’t see a reason that needs to be done *now* for static pages, login forms, etc.

### During Development

The frontend app runs its own little development server that will proxy API requests to JSON APIs provided by the Rails app on localhost. (This can easily be configured to the project)

Later this frontend app could be also run against a shared development Rails server so that you wouldn’t necessarily need a full Rails+postgres setup while only working on the frontend. (This is another benefit of using this architecture.)

### In Production

The frontend app is built into static files (JS, CSS, assets) and deployed to the public web path of the Rails app.

The application’s host HTML page can be a static page, or it can be generated by a Rails view if necessary.


## Proposed Next Steps

* Flesh out the concrete navigation structure and how exactly the frontend app will integrate with corva-web (see required inputs below).
* Implement at least one widget. As part of this work several things will be fleshed out:
  * API integration with corva-web
  * Widget component structure, as well as the underlying Redux state and reducer structure. For this, I will port over some of the existing work done with Redux in the develop branch and corva-web.
  * Idiomatic and efficient use of amCharts with React.
* Implement the timeline control.

## Inputs Needed

* Any questions / concerns about this direction?
* A written-out list of the navigation of the whole application. I’m having some trouble connecting the current app navigation and what I’m seeing in the new designs, and on the other hand what we’ve discussed. I think we basically need a bullet-point list of the navigation structure of the whole project, including:
  * Main menu and tab structure
  * Which parts are new and which parts exist in the current version.
    * Which of the existing parts do we want to keep using without reimplementing yet. (i.e. what should we pull in from Rails land)

* Details about the first component (the Broomstick under Torque & Drag?):
  *  Is there an existing JSON API for the data shown in this graph? Where is it?
  * What are the relevant parts in the corva-web code that currently implement the chart.
  * Any ideas for how we want this chart to behave on different widget sizes? (Which sizes does it support, and what are the functional difference between them?) 

